deploy:
  name: Deploy to GCP
  runs-on: ubuntu-latest
  needs: build

  permissions:
    contents: 'read'

  steps:
    - name: Check out code
      uses: actions/checkout@v4

    - name: Set up Cloud SDK
      uses: google-github-actions/setup-gcloud@v3
      with:
        version: '>= 363.0.0'
        service_account_key: ${{ secrets.GCP_CREDENTIALS }}
        project_id: notely-470914

    - name: Verify gcloud CLI
      run: gcloud info

    - name: Build and push image
      run: gcloud builds submit --tag us-central1-docker.pkg.dev/notely-470914/notely-ar-repo/notely:latest .
